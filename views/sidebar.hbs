{{!< layout}}
<div class="aui-group sidebar">
    <div class="aui-row">
        <div class="aui-item">
          <h3>Skel List</h3>
          {{#each skels}}
            <div class="skel-container">
              <span class="skel-title">{{@key}}</span>
              <div class="skel-details hidden">
                <form id="{{@key}}-deployment" class="deployment-form" method="get">
                {{#each this}}
                    <input id="{{@../key}}-{{this}}" type="radio" name="env" value="{{this}}" />
                    <label for="{{@../key}}-{{this}}">{{this}}<br>
                {{/each}}
                </form>
              </div>
            </div>
          {{/each}}
        </div>
    </div>
    <br>
    <div class="aui-row">
        <div class="aui-item">
            <h4 id="details-title"></h4>
            <pre id="details"></pre>
        </div>
    </div>
    <br>
    <div class="aui-row">
        <div class="aui-item">
            <button id="say_hello" class="aui-button">Say Hello!</button>
        </div>
    </div>
</div>
<script>

$('.skel-title').on('click', function() {
  var $target = $(this).next('.skel-details');
  $target.toggle();
  $('.skel-details').not($target).hide();
});

$('#say_hello').on('click', function(){
    $.ajax({
        type: 'POST',
        url: '/send_notification',
        headers: { 'Authorization': 'JWT {{signed_request}}' },
        dataType: 'json',
        data: {}
    });
});

// The following are client-side APIs you can call to get information about
// the room or user. For more information, go to:
// https://developer.atlassian.com/hipchat/guide/hipchat-ui-extensions/views/javascript-api#JavascriptAPI-GettingcontextualinformationfromtheHipChatClient

$('#room').on('click', function(){
    AP.require('room', function(room){
       room.getRoomDetails(function(err, data){
          if (!err) {
              $('#details-title').html('Room details');
              $('#details').html(JSON.stringify(data, null, 2));
          }
       });
    });
});

$('#participants').on('click', function(){
    AP.require('room', function(room){
       room.getParticipants(function(err, data){
          if (!err) {
              $('#details-title').html('Room participants');
              $('#details').html(JSON.stringify(data, null, 2));
          }
       });
    });
});

$('#user').on('click', function(){
    AP.require('user', function(user){
       user.getCurrentUser(function(err, data){
          if (!err) {
              $('#details-title').html('User details');
              $('#details').html(JSON.stringify(data, null, 2));
          }
       });
    });
});
</script>