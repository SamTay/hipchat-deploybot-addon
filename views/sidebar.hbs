{{!< layout}}
<div class="aui-group sidebar">
  <div class="aui-row">
    <div class="aui-item">
      <h3>Skel List</h3>
      {{#each skels}}
      <div class="skel-container">
        <span class="skel-title">{{@key}}</span>
        <div class="skel-details hidden">
          <form id="{{@key}}-deployment" class="deployment-form" method="get">
            {{#each this}}
            <div id="{{@../key}}-{{this}}" class="environment-wrapper">
              <button class="icon-button deploy-button"><i class="fa fa-level-up"></i></button>
              <button class="icon-button history-button"><i class="fa fa-history"></i></button>
              <label for="{{@../key}}-{{this}}">{{this}}</label>
            </div>
            {{/each}}
          </form>
        </div>
      </div>
      {{/each}}
    </div>
  </div>
</div>
<script>
  $('.skel-title').on('click', function() {
    var $target = $(this).next('.skel-details');
    var $parentTarg = $target.parent();
    $target.slideToggle('fast');

    $parentTarg.toggleClass('active');
    $('.active').not($parentTarg).removeClass('active');
    $('.skel-details').not($target).slideUp('fast');
});

  $('#say_hello').on('click', function(){
    $.ajax({
      type: 'POST',
      url: '/send_notification',
      headers: { 'Authorization': 'JWT {{signed_request}}' },
      dataType: 'json',
      data: {}
    });
  });

  // The following are client-side APIs you can call to get information about
  // the room or user. For more information, go to:
  // https://developer.atlassian.com/hipchat/guide/hipchat-ui-extensions/views/javascript-api#JavascriptAPI-GettingcontextualinformationfromtheHipChatClient

  $('#room').on('click', function(){
    AP.require('room', function(room){
      room.getRoomDetails(function(err, data){
        if (!err) {
          $('#details-title').html('Room details');
          $('#details').html(JSON.stringify(data, null, 2));
        }
      });
    });
  });

  $('#participants').on('click', function(){
    AP.require('room', function(room){
      room.getParticipants(function(err, data){
        if (!err) {
          $('#details-title').html('Room participants');
          $('#details').html(JSON.stringify(data, null, 2));
        }
      });
    });
  });

  $('#user').on('click', function(){
    AP.require('user', function(user){
      user.getCurrentUser(function(err, data){
        if (!err) {
          $('#details-title').html('User details');
          $('#details').html(JSON.stringify(data, null, 2));
        }
      });
    });
  });
</script>
